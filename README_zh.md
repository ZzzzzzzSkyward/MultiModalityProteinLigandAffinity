# 蛋白质-配体亲和力的多模态预测框架

## 动机

近期的蛋白质-配体亲和力和接触预测主要关注氨基酸序列、2D图和化学指纹数据来提取蛋白质和配体的特征。为了尝试结合分子的不同视角的优势，交叉模态模型被开发出来，包括1D+2D、2D+3D模式，可以利用所有模态或将某些视为特权资源。考虑到高维数据的稀缺性，预训练和无监督学习等方法也被引入到这个领域。另一方面，分子的多个视角包含多种特征，可能也会增强模型对蛋白质、配体及其相互作用的理解。

## 结果

[待填]

## 数据

实验中使用的所有蛋白质-配体对都来自于PDBBind 2020精炼数据集。你可以从[PDBBind](http://pdbbind.org.cn/)下载。截至实验进行时，PDBBind 2021数据集仍未公布。只要 `pdb`、`sdf`和 `mol2`文件可用，当然你也可以使用其他来源的数据。

处理数据的所有脚本都放在 `preprocess`、`biozernike`和 `TopologyNet`中。实验设计使用8种类型的数据：蛋白质的氨基酸序列、配体的SMILES表示、蛋白质的接触图、配体的邻接矩阵、蛋白质和配体的拓扑结构、蛋白质的泽尼克描述符。

数据集被随机分成训练集 `train`、验证集（均存在 `test_both_present`）和测试集（蛋白质未出现 `test_ligand_only`、配体未出现 `test_protein_only`和两者都没有 `test_both_none`）。配体的标识完全由索引文件中的名称确定，即使索引里的名称并不总是能够标识同一个配体。本实验没有进行交叉验证，所有数据集从一开始就划分完毕，如下表所示，符号 `-`表示同上。

| 数据集               | 大小 | 蛋白质数目 | 配体数目 | 唯一蛋白质数目 | 唯一配体数目 |
| -------------------- | ---- | ---------- | -------- | -------------- | ------------ |
| 训练集               | 4532 | 3174       | 3460     |                |              |
| 验证集               | 147  | 119        | 120      |                |              |
| 化合物未在训练集出现 | 176  | 570        | 564      | 344            | 453          |
| 蛋白质未在训练集出现 | 291  | -          | -        | -              | -            |
| 两者都未在训练集出现 | 170  | -          | -        | -              | -            |
| 总计                 | 5316 | 3863       | 4144     |                |              |

数据准备过程如下：

1. 从索引中随机选取固定比例的蛋白质-配体对，加入训练集；剩下的根据是否出现过蛋白质或配体，划分成四组，其中均出现的组当做验证集，剩下三组当做测试集。
2. 根据pdb文件里的信息，使用自定义氨基酸字典将氨基酸序列转换为数列，如果有多条链则直接拼接起来，没有分隔符。化合物则使用SMILES表示法转换为字符串。为了满足矩阵格式要求，对过长的氨基酸序列进行了末尾裁剪，化合物则没有裁剪。
3. 从索引中提取出Kd或Ki，转化为 `-log(k)`，无论是Kd还是Ki都一视同仁，当做标签。
4. 根据[TopologyNet](https://github.com/WeilabMSU/TopologyNet)提供的算法，计算出 `alpha`，`electric`和 `interact`三种蛋白质-配体复合物的拓扑信息，`alpha`，`lv1`两种配体的拓扑信息。
5. 在上一步中，由于部分pdb或pqr文件无法计算，使用[PDBFixer](https://github.com/openmm/pdbfixer)与[Swiss PDB Viewer](https://spdbv.unil.ch/)修复。但是仍然有一些无法计算，对于这些使用0填充。
6. 使用[BioZernike](https://github.com/biocryst/biozernike/tree/master)工具包计算出 `zernike`描述符，将 `geo`和 `moment`两种描述符拼接起来。

其余还有一些数据，比如摩根指纹（`fingerprint`），SELFIES表示法（`selfies`），以及两个邻接矩阵（成键，距离）与顶点特征（`matrix `和 `2dfeature`），本次实验没有使用。

## 实验

提供的脚本使用的是pytorch 1.11和cuda 11.3。所有所需的Python库可以在 `header.py`中找到。

训练轮数若无说明就是100（对于一些时序模型，这个轮数尚未完成充分训练；但受限于硬件条件不再继续训练；此外，为了保证公平，延长了一些非预训练模型的轮数），优化器是AdamW，损失函数是MSE，批次是32，指标是皮尔逊相关系数、RMSE、肯德尔τ相关系数tau、斯皮尔曼秩相关系数rho。

本实验选择简单的MLP作为基线模型，以衡量其他模型的性能，同时附带了一些其他论文的模型以供参考。

与[CPAC](https://github.com/Shen-Lab/CPAC/tree/main)的实验数据相比，不知为何，蛋白质不出现测试集的数值有时是最低的。理论上应当是均不出现测试集数值最低。

### 三层MLP（基线）

训练轮数为200

每层分别是Linear,LeakyReLU,BatchNorm,Dropout

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 75.95   | 3.27 | 53.94 | 72.68 |
| 无化合物 | 68.33   | 3.32 | 48.24 | 66.42 |
| 无蛋白质 | 58.30   | 3.55 | 39.62 | 55.78 |
| 均无     | 58.43   | 3.94 | 37.74 | 53.75 |

### 六层MLP（基线）

训练轮数为200

在三层MLP的基础上加了几层，结果表明，加深MLP并未显著改变模型的性能，因此选择三层MLP作为通用模块是合理的

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 76.56   | 3.06 | 54.02 | 73.40 |
| 无化合物 | 68.44   | 3.34 | 50.36 | 68.40 |
| 无蛋白质 | 55.71   | 3.51 | 36.89 | 52.18 |
| 均无     | 57.03   | 3.83 | 37.73 | 53.11 |

### DeepLPI

[DeepLPI](https://github.com/David-BominWei/DeepLPI)是一个使用1dCNN和LSTM，并且使用了残差模块的模型。首先用1dCNN编码，然后拼起来过LSTM，最后用三层MLP解码。

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 76.56   | 3.01 | 55.79 | 73.05 |
| 无化合物 | 75.23   | 3.16 | 53.83 | 73.04 |
| 无蛋白质 | 60.89   | 3.55 | 39.98 | 56.04 |
| 均无     | 65.67   | 3.55 | 44.64 | 62.04 |

### CPAC

基于论文[Cross-Modality and Self-Supervised Protein Embedding for Compound-Protein Affinity and Contact Prediction](https://github.com/Shen-Lab/CPAC)里的模型修改，包括32-mer GRU编码器与MLP融合层，融合得到氨基酸序列与化合物序列的二维矩阵，以表达每个氨基酸与每个化合物原子的相互作用。

去除了原论文里为模型定制的损失函数，同时修改了融合模块以适用于本实验的数据集。

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 75.78   | 3.07 | 54.65 | 72.74 |
| 无化合物 | 72.28   | 3.15 | 51.13 | 70.37 |
| 无蛋白质 | 62.32   | 3.42 | 41.50 | 58.28 |
| 均无     | 67.37   | 3.42 | 46.40 | 65.20 |

### CNN+GRU

先过1dCNN，再过GRU

训练轮数为200

后续融合模型均以此为基础

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 76.33   | 3.07 | 56.84 | 76.62 |
| 无化合物 | 77.82   | 3.02 | 57.00 | 76.11 |
| 无蛋白质 | 52.29   | 3.79 | 35.28 | 50.09 |
| 均无     | 64.09   | 3.64 | 45.14 | 63.31 |

### Zernike

以下几个实验选择添加泽尼克描述符。泽尼克描述符能够刻画蛋白质的形状与电荷分布。

使用1dCNN与MLP编码泽尼克描述符。

由实验结果看出，泽尼克描述符的学习难度大于氨基酸序列，100轮时RMSE约为5，模型尚未训练完成。

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 57.76   | 4.90 | 41.87 | 58.71 |
| 无化合物 | 59.62   | 4.09 | 41.62 | 59.19 |
| 无蛋白质 | 56.99   | 4.07 | 37.83 | 54.43 |
| 均无     | 58.70   | 4.61 | 41.85 | 58.68 |

### Concat Zernike, Concat Compound

泽尼克描述符与氨基酸序列，通过拼接+MLP得到蛋白质的联合表征。

然后再与化合物编码拼接。

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 75.81   | 3.12 | 55.74 | 73.95 |
| 无化合物 | 75.08   | 3.05 | 54.28 | 73.25 |
| 无蛋白质 | 55.33   | 3.68 | 38.03 | 54.55 |
| 均无     | 63.79   | 3.62 | 44.00 | 61.85 |

### Concat All

泽尼克描述符、氨基酸序列、化合物三者的编码拼接。

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 79.13   | 3.03 | 58.94 | 77.26 |
| 无化合物 | 79.59   | 2.75 | 58.81 | 78.04 |
| 无蛋白质 | 56.14   | 3.58 | 38.16 | 53.51 |
| 均无     | 66.11   | 3.53 | 46.33 | 64.42 |

### Pretrain Zernike

对蛋白质编码器进行预训练，从氨基酸序列预测泽尼克描述符。

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 72.79   | 3.27 | 50.89 | 68.04 |
| 无化合物 | 69.14   | 3.44 | 48.79 | 68.24 |
| 无蛋白质 | 42.90   | 4.11 | 28.52 | 40.36 |
| 均无     | 50.17   | 4.07 | 34.72 | 49.41 |

### Pretrain Zernike+Freeze

冻结蛋白质编码器。

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 67.05   | 3.48 | 47.93 | 66.74 |
| 无化合物 | 70.98   | 3.38 | 50.09 | 68.62 |
| 无蛋白质 | 59.67   | 3.41 | 40.00 | 56.94 |
| 均无     | 61.28   | 3.69 | 42.63 | 59.75 |

### Complex Interact

使用复合物的相互作用数据

| 数据集   | pearson | RMSE | tau   | rho   |
| -------- | ------- | ---- | ----- | ----- |
| 验证集   | 60.57   | 5.80 | 40.76 | 58.74 |
| 无化合物 | 55.73   | 5.28 | 37.33 | 53.58 |
| 无蛋白质 | 52.92   | 5.04 | 34.18 | 48.71 |
| 均无     | 42.90   | 6.18 | 31.07 | 45.54 |

## 引用

[待填]
